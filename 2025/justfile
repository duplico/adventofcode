# Advent of Code 2025 - Task Runner
# Install: cargo install just (or: brew install just, apt install just)
# Usage: just new 02 python

set shell := ["bash", "-uc"]

# Default recipe: show help
default:
    @just --list

# Create a new day from a skeleton
# Usage: just new <day> <language>
# Example: just new 02 python
new day lang:
    #!/usr/bin/env bash
    set -euo pipefail

    DAY="{{day}}"
    LANG="{{lang}}"
    SKEL_DIR="skel/${LANG}"
    TARGET_DIR="${DAY}"

    # Validate day format (01-25)
    if [[ ! "$DAY" =~ ^[0-2][0-9]$ ]]; then
        echo "Error: Day must be two digits (01-25), got: $DAY"
        exit 1
    fi

    # Check skeleton exists
    if [[ ! -d "$SKEL_DIR" ]]; then
        echo "Error: No skeleton found for language '$LANG'"
        echo "Available languages:"
        ls -1 skel/
        exit 1
    fi

    # Check target doesn't exist
    if [[ -d "$TARGET_DIR" ]]; then
        echo "Error: Directory '$TARGET_DIR' already exists"
        exit 1
    fi

    # Copy skeleton
    cp -r "$SKEL_DIR" "$TARGET_DIR"

    # Create empty input files
    touch "$TARGET_DIR/input.txt"
    touch "$TARGET_DIR/sample_input.txt"

    # Language-specific post-processing
    case "$LANG" in
        python)
            echo "Initializing Python project with uv..."
            cd "$TARGET_DIR" && uv sync
            ;;
        go)
            echo "Initializing Go module..."
            cd "$TARGET_DIR" && go mod tidy
            ;;
        rust)
            echo "Rust project ready. Run 'cargo build' to compile."
            ;;
        clojure)
            echo "Clojure project ready. Run 'clj -M:run 1 input.txt' to start."
            ;;
        c)
            echo "C project ready. Run 'make' to compile."
            ;;
        tcl)
            echo "Tcl project ready. Run 'tclsh advent.tcl 1 input.txt' to start."
            ;;
    esac

    echo ""
    echo "âœ“ Created day $DAY using $LANG skeleton"
    echo "  Directory: $TARGET_DIR/"
    echo ""
    echo "Next steps:"
    echo "  1. Paste your puzzle input into $TARGET_DIR/input.txt"
    echo "  2. Paste sample input into $TARGET_DIR/sample_input.txt"
    echo "  3. Start coding!"

# List available skeleton languages
langs:
    @echo "Available languages:"
    @ls -1 skel/

# Run a solution (auto-detects language)
# Usage: just run <day> <part> [args...]
# Example: just run 01 1 -v
run day part *args:
    #!/usr/bin/env bash
    set -euo pipefail

    DAY="{{day}}"
    PART="{{part}}"
    ARGS="{{args}}"

    cd "$DAY"

    if [[ -f "pyproject.toml" ]]; then
        uv run advent "$PART" input.txt $ARGS
    elif [[ -f "Cargo.toml" ]]; then
        cargo run --release -- "$PART" input.txt $ARGS
    elif [[ -f "go.mod" ]]; then
        go run . "$PART" input.txt $ARGS
    elif [[ -f "deps.edn" ]]; then
        clj -M:run "$PART" input.txt $ARGS
    elif [[ -f "Makefile" ]]; then
        make && ./advent "$PART" input.txt $ARGS
    elif [[ -f "advent.tcl" ]]; then
        tclsh advent.tcl "$PART" input.txt $ARGS
    else
        echo "Error: Could not detect language for day $DAY"
        exit 1
    fi

# Run with sample input
# Usage: just sample <day> <part> [args...]
sample day part *args:
    #!/usr/bin/env bash
    set -euo pipefail

    DAY="{{day}}"
    PART="{{part}}"
    ARGS="{{args}}"

    cd "$DAY"

    if [[ -f "pyproject.toml" ]]; then
        uv run advent "$PART" sample_input.txt $ARGS
    elif [[ -f "Cargo.toml" ]]; then
        cargo run -- "$PART" sample_input.txt $ARGS
    elif [[ -f "go.mod" ]]; then
        go run . "$PART" sample_input.txt $ARGS
    elif [[ -f "deps.edn" ]]; then
        clj -M:run "$PART" sample_input.txt $ARGS
    elif [[ -f "Makefile" ]]; then
        make && ./advent "$PART" sample_input.txt $ARGS
    elif [[ -f "advent.tcl" ]]; then
        tclsh advent.tcl "$PART" sample_input.txt $ARGS
    else
        echo "Error: Could not detect language for day $DAY"
        exit 1
    fi
